#*******************************
#export REPLAY_MEM=label_random
export REPLAY_MEM=label_priority

#export DQN_TYPE=dqn
export DQN_TYPE=ddqn

#export DQN_MODE=bert
export DQN_MODE=lstm
#export DQN_MODE=ggnn
#export DQN_MODE=transformer

#export MODEL_TYPE=bert
#export MODEL_NAME=bert-base-cased
#export LOWER_CASE=0

#export MODEL_TYPE=bert
#export MODEL_NAME=bert-base-uncased
#export LOWER_CASE=1

#export MODEL_TYPE=albert
#export MODEL_NAME=albert-large-v2
#export LOWER_CASE=1

export MODEL_TYPE=xlnet
export MODEL_NAME=xlnet-large-cased
export LOWER_CASE=0

export CHECKPOINT=output/xlnet-large-cased/xlnet-ddqn-lstm-label_priority-mean-5e-6-v5+6/30-0-0.3423457088631833

export LEARNING_RATE=5e-5
#export LEARNING_RATE=5e-6

#export BATCH_SIZE=100
#export BATCH_SIZE=64
export BATCH_SIZE=32
#export LEARNING_RATE=1e-5

export GPU=1
#export AGGREGATE=attn_max      # dueling
#export AGGREGATE=attn_mean    # dueling
#export AGGREGATE=last
#export AGGREGATE=attn
export AGGREGATE=mean
#export AGGREGATE=max
#*************************************

export BERT_PATH=data/bert/$MODEL_NAME
export OUTPUT_DIR=output/$MODEL_NAME/$MODEL_TYPE-$DQN_TYPE-$DQN_MODE-$REPLAY_MEM-$AGGREGATE-$LEARNING_RATE-v5+6
#export OUTPUT_DIR=output/$MODEL_NAME/$MODEL_TYPE-$DQN_TYPE-$DQN_MODE-$REPLAY_MEM-$AGGREGATE-$LEARNING_RATE-dueling-v5+6
export GLUE_DIR=data/dqn
export MAX_SEQ_LENGTH=387
export MAX_SENT_LENGTH=64
export EPOCHS=30
export SAVE_STEPS=100000
export EPS_DECAY=2000
export CAPACITY=20000
#export TARGET_UPDATE=10
#export TARGET_UPDATE=5
export TARGET_UPDATE=2
export NUM_LAYERS=3

CUDA_VISIBLE_DEVICES=$GPU python src/run_fever.py \
    --model_type $MODEL_TYPE \
    --model_name_or_path $BERT_PATH \
    --do_train \
    --do_eval \
    --data_dir $GLUE_DIR \
    --max_seq_length $MAX_SEQ_LENGTH \
    --max_sent_length $MAX_SENT_LENGTH \
    --per_gpu_train_batch_size $BATCH_SIZE \
    --per_gpu_eval_batch_size $BATCH_SIZE \
    --learning_rate $LEARNING_RATE \
    --num_train_epochs $EPOCHS \
    --output_dir $OUTPUT_DIR \
    --overwrite_output_dir \
    --save_steps $SAVE_STEPS \
    --dqn_type $DQN_TYPE \
    --dqn_mode $DQN_MODE \
    --eps_decay $EPS_DECAY \
    --mem $REPLAY_MEM \
    --do_lower_case $LOWER_CASE \
    --capacity $CAPACITY \
    --target_update $TARGET_UPDATE \
    --num_layers $NUM_LAYERS \
    --aggregate $AGGREGATE \
    --proportion 1 1 1 \
    --checkpoint $CHECKPOINT \
    #--dueling \
